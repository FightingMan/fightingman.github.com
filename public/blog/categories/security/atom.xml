<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Security | FightingMan's FootPrints]]></title>
  <link href="http://FightingMan.github.com/blog/categories/security/atom.xml" rel="self"/>
  <link href="http://FightingMan.github.com/"/>
  <updated>2014-04-24T00:53:09+08:00</updated>
  <id>http://FightingMan.github.com/</id>
  <author>
    <name><![CDATA[FightingMan]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Connect to postgresql via msfconsole in Metasploit]]></title>
    <link href="http://FightingMan.github.com/blog/2012/12/04/connect-to-postgresql-via-msfconsole-in-metasploit/"/>
    <updated>2012-12-04T18:52:00+08:00</updated>
    <id>http://FightingMan.github.com/blog/2012/12/04/connect-to-postgresql-via-msfconsole-in-metasploit</id>
    <content type="html"><![CDATA[<p>Today I'm testing metasploit in bt5,there is a problem takes me some time,yes,this is a bug,show these codes:</p>

<pre><code>root@bt:~# cd /opt/metasploit/
root@bt:/opt/metasploit# cat config/database.yml 
    development:
    adapter: "postgresql"
    database: "msf3dev"
    username: "msf3"
    password: "4bfedfc2"
    port: 7337
    host: "localhost"
    pool: 256
    timeout: 5

    production:
    adapter: "postgresql"
    database: "msf3dev"
    username: "msf3"
    password: "4bfedfc2"
    port: 7337
    host: "localhost"
    pool: 256
    timeout: 5
root@bt:/opt/metasploit# netstat -tunpl | grep postgres
tcp        0      0 127.0.0.1:7337          0.0.0.0:*               LISTEN      1321/postgres.bin
tcp6       0      0 ::1:7337                :::*                    LISTEN      1321/postgres.bin
root@bt:/opt/metasploit# cd msf3
root@bt:/opt/metasploit/msf3# ./msfconsole

# cowsay++
 ____________
&lt; metasploit &gt;
 ------------
       \   ,__,
        \  (oo)____
           (__)    )\
              ||--|| *


       =[ metasploit v4.5.0-dev [core:4.5 api:1.0]
+ -- --=[ 927 exploits - 499 auxiliary - 151 post
+ -- --=[ 251 payloads - 28 encoders - 8 nops

msf &gt; db_connect msf3:4bfedfc2@localhost:7337/msf3dev
      [-] No database driver installed. Try 'gem install pg'
</code></pre>

<p>msf3 is the username in database.yml;
4bfedfc2 is the password in database.yml;
msf3dev is the database in database.yml;
and the 7337 is the port for postgresql.</p>

<!--more-->


<pre><code>msf &gt; find / -iname pg_config
[*] exec: find / -iname pg_config

/opt/metasploit/postgresql/bin/pg_config
msf &gt; gem install pg -- --with-pg-config=/opt/metasploit/postgresql/bin/pg_config
[*] exec: gem install pg -- --with-pg-config=/opt/metasploit/postgresql/bin/pg_config

Building native extensions.  This could take a while...
Successfully installed pg-0.14.1
1 gem installed
Installing ri documentation for pg-0.14.1...
Installing RDoc documentation for pg-0.14.1...
msf &gt; db_connect msf3:4bfedfc2@localhost:7337/msf3dev
    [-] No database driver installed. Try 'gem install pg'//also
</code></pre>

<p>At last I've found out that the problem is related to the installed ruby version.
The start script of msfconsole uses /usr/bin/env ruby as Parser.
But metasploit seems to have an own version of ruby which you can use by changing msfconsole.
you can test it by yourself:</p>

<pre><code>root@bt:/opt/metasploit/msf3# /opt/metasploit/ruby/bin/ruby -v
ruby 1.9.3p125 (2012-02-16 revision 34643) [i686-linux]
root@bt:/opt/metasploit/msf3# /usr/bin/ruby -v
ruby 1.9.2dev (2010-07-02) [i486-linux]

vi /opt/metasploit/msf3/msfconsole
change #!/usr/bin/env ruby to #!/opt/metasploit/ruby/bin/ruby in the top of msfconsole.
msf &gt; db_connect msf3:4bfedfc2@localhost:7337/msf3dev
</code></pre>

<p>Now it will work fine and show you a lot of text output as Metasploit sets up all the necessary tables;</p>

<p>Enjoy it :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Reinforcement php environment via php.ini]]></title>
    <link href="http://FightingMan.github.com/blog/2012/12/03/reinforcement-php-environment-via-php-dot-ini/"/>
    <updated>2012-12-03T10:59:00+08:00</updated>
    <id>http://FightingMan.github.com/blog/2012/12/03/reinforcement-php-environment-via-php-dot-ini</id>
    <content type="html"><![CDATA[<p>I'm reading &lt;White hat talk about security of Web> written by aullik5,found that some generic option can reinforcement php env via php.ini,now share it.</p>

<p>1.register_globals.</p>

<pre><code>register_globals = Off
Prevent from variables override.
</code></pre>

<p>2.open_basedir</p>

<pre><code>Limit the files that can be opened by PHP to the specified directory-tree, including the file itself.
When you want to restrict access to only the specified directory, end with a slash. For example: open_basedir = /dir/incl/,if not it will set as prefix.
</code></pre>

<p>3.allow_url_fopen &amp; allow_url_include</p>

<pre><code>allow_url_include = Off
allow_url_fopen = Off
</code></pre>

<p>4.display_errors &amp; log_errors</p>

<pre><code>display_errors = Off
log_errors = On
If u turn it on,will give enough information to the attacker.The best way just put them into logs.
</code></pre>

<!--more-->


<p>5.magic_quotes_gpc <a href="http://stackoverflow.com/questions/2610524/why-turning-magic-quotes-gpc-on-in-php-is-considered-a-bad-practice">more</a></p>

<pre><code>magic_quotes_gpc = Off
Many methods can bypass it.
</code></pre>

<p>6.cgi.fix_pathinfo <a href="https://nealpoole.com/blog/2011/04/setting-up-php-fastcgi-and-nginx-dont-trust-the-tutorials-check-your-configuration/">more</a></p>

<pre><code>cgi.fix_pathinfo = 0 
</code></pre>

<p>7.session.cookie_httponly &amp; session.cookie_secure</p>

<pre><code>session.cookie_httponly = true
Prevent cross site script,javascript can't get the cookie's value.
session.cookie_secure = true
if u use https pass through the site.
</code></pre>

<p>8.safe_mode &amp; disable_functions</p>

<pre><code>safe_mode = 0
disable_functions = "apache_child_terminate, apache_setenv, define_syslog_variables, escapeshellarg, escapeshellcmd, eval, exec, dl, fsocket, pfsockopen, fsockopen, fp, fput, ftp_connect, ftp_exec, ftp_get, ftp_login, ftp_nb_fput, ftp_put, ftp_raw, ftp_rawlist, highlight_file, ini_alter, ini_get_all, ini_restore, inject_code, mysql_pconnect, openlog, phpinfo, passthru, php_uname, phpAds_remoteInfo, phpAds_XmlRpc, phpAds_xmlrpcDecode, phpAds_xmlrpcEncode, popen, posix_getpwuid, posix_kill, posix_mkfifo, posix_setpgid, posix_setsid, posix_setuid, posix_setuid, posix_uname, proc_close, proc_get_status, proc_nice, proc_open, proc_terminate, shell_exec, syslog, system, system,proc_open, symlink, xmlrpc_entity_decode, popen, curl_exec, curl_multi_exec, parse_ini_file, show_source" and etc.
</code></pre>

<p>At last we must always take care of user's input data and set correct right of web app dir.</p>
]]></content>
  </entry>
  
</feed>
